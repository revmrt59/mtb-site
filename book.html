<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mastering the Bible</title>

  <link rel="stylesheet" href="assets/css/style.css" />
</head>

<body>

  <!-- SITE HEADER (Donate removed) -->
  <header class="site-header">
    <nav class="main-nav">
      <a href="index.html">Home</a>
      <a href="#">Resources</a>
      <a href="#">About</a>
      <a href="#">Contact</a>
    </nav>
  </header>

  <!-- BOOK NAVIGATION -->
  <nav class="book-nav" aria-label="MTB navigation">
    <div class="book-nav-row">

      <select id="bookSelect" class="book-select" aria-label="Book"></select>

      <select id="chapterSelect" class="book-select" aria-label="Chapter"></select>

      <a id="introLink" class="book-action" href="#">Book Intro</a>
      <a id="orientationLink" class="book-action" href="#">Orientation</a>
      <a id="teachingLink" class="book-action" href="#">Teaching</a>
      <a id="scriptureLink" class="book-action" href="#">Scripture</a>

    </div>
  </nav>

  <!-- DOCUMENT CONTENT -->
  <main class="doc">
    <div id="doc-target">Loadingâ€¦</div>
  </main>

  <!-- Loader that fetches /books/<testament>/<book>/generated/<doc> -->
  <script src="assets/js/load-doc.js"></script>

  <!-- Dropdowns + dynamic tab names -->
  <script>
    (function () {

      // For now, hardcode what exists. Later we can drive this from a manifest JSON.
      const MTB_CONTENT = [
        { name: "Titus", slug: "titus", chapters: [1, 2, 3] }
      ];

      const params = new URLSearchParams(window.location.search);
      const doc = params.get("doc") || "";

      const bookSelect = document.getElementById("bookSelect");
      const chapterSelect = document.getElementById("chapterSelect");

      const introLink = document.getElementById("introLink");
      const orientationLink = document.getElementById("orientationLink");
      const teachingLink = document.getElementById("teachingLink");
      const scriptureLink = document.getElementById("scriptureLink");

      if (!bookSelect || !chapterSelect) return;

      function populateBooks() {
        bookSelect.innerHTML = "";
        MTB_CONTENT.forEach(book => {
          if (!book.chapters || book.chapters.length === 0) return;
          const opt = document.createElement("option");
          opt.value = book.slug;
          opt.textContent = book.name;
          bookSelect.appendChild(opt);
        });
      }

      function populateChapters(bookSlug) {
        chapterSelect.innerHTML = "";
        const book = MTB_CONTENT.find(b => b.slug === bookSlug);
        const chapters = (book && book.chapters) ? book.chapters : [];

        chapters.forEach(n => {
          const opt = document.createElement("option");
          opt.value = String(n);
          opt.textContent = "Chapter " + n;
          chapterSelect.appendChild(opt);
        });
      }

      function getBookName(bookSlug) {
        const b = MTB_CONTENT.find(x => x.slug === bookSlug);
        return b ? b.name : bookSlug;
      }

      function setTabNames(bookSlug, chapterNum) {
        const bookName = getBookName(bookSlug);

        // Your exact requested labels
        introLink.textContent = "What is " + bookName + " About?";
        orientationLink.textContent = "What is " + bookName + " " + chapterNum + " About?";
        teachingLink.textContent = "Understanding " + bookName + " " + chapterNum;
        scriptureLink.textContent = bookName + " " + chapterNum + " Parallel Versions";
      }

      function setLinks(bookSlug, chapterNum) {
        // Book intro is always chapter 0
        introLink.href = "book.html?doc=" + encodeURIComponent(bookSlug + "-0-book-introduction.html");

        // Chapter content
        orientationLink.href = "book.html?doc=" + encodeURIComponent(bookSlug + "-" + chapterNum + "-chapter-orientation.html");
        teachingLink.href = "book.html?doc=" + encodeURIComponent(bookSlug + "-" + chapterNum + "-chapter-teaching.html");
        scriptureLink.href = "book.html?doc=" + encodeURIComponent(bookSlug + "-" + chapterNum + "-chapter-scripture.html");

        setTabNames(bookSlug, chapterNum);
      }

      function inferFromDocParam() {
        // doc examples:
        // titus-0-book-introduction.html
        // titus-1-chapter-orientation.html
        // titus-1-chapter-teaching.html
        // titus-1-chapter-scripture.html

        const intro = doc.match(/^([a-z0-9-]+)-0-book-introduction\.html$/);
        if (intro) return { book: intro[1], chapter: null };

        const chap = doc.match(/^([a-z0-9-]+)-(\d+)-chapter-(orientation|teaching|scripture)\.html$/);
        if (chap) return { book: chap[1], chapter: Number(chap[2]) };

        // fallback
        const first = MTB_CONTENT[0] || { slug: "titus", chapters: [1] };
        return { book: first.slug, chapter: first.chapters[0] || 1 };
      }

      // INIT
      populateBooks();

      const inferred = inferFromDocParam();
      const currentBook = inferred.book || (MTB_CONTENT[0] ? MTB_CONTENT[0].slug : "titus");

      bookSelect.value = currentBook;
      populateChapters(currentBook);

      // If viewing intro, pick first chapter in dropdown
      const bookObj = MTB_CONTENT.find(b => b.slug === currentBook);
      const firstChapter = (bookObj && bookObj.chapters && bookObj.chapters.length) ? bookObj.chapters[0] : 1;
      const currentChapter = inferred.chapter ? inferred.chapter : firstChapter;

      chapterSelect.value = "Chapter " + currentChapter; // in case of mismatch
      chapterSelect.value = String(currentChapter);

      setLinks(currentBook, currentChapter);

      bookSelect.addEventListener("change", function () {
        populateChapters(bookSelect.value);
        const b = MTB_CONTENT.find(x => x.slug === bookSelect.value);
        const chap = (b && b.chapters && b.chapters.length) ? b.chapters[0] : 1;
        chapterSelect.value = String(chap);
        setLinks(bookSelect.value, chap);
      });

      chapterSelect.addEventListener("change", function () {
        setLinks(bookSelect.value, chapterSelect.value);
      });

    })();
  </script>

</body>
</html>
